---
name: seaweedfs-broker

templates:
  ctl.erb: bin/ctl
  broker.yml.erb: config/broker.yml
  bpm.yml.erb: config/bpm.yml
  ca.crt.erb: config/certs/ca.crt
  server.crt.erb: config/certs/server.crt
  server.key.erb: config/certs/server.key
  bosh_ca.crt.erb: config/certs/bosh_ca.crt

packages:
  - seaweedfs-broker

consumes:
  - name: seaweedfs-s3
    type: seaweedfs-s3
    optional: true

provides:
  - name: seaweedfs-broker
    type: seaweedfs-broker
    properties:
      - seaweedfs.broker.port

properties:
  seaweedfs.broker.port:
    description: "Port for the service broker API"
    default: 8080

  seaweedfs.broker.log_level:
    description: "Log level (debug, info, warn, error)"
    default: "info"

  seaweedfs.broker.auth.username:
    description: "Basic auth username for the broker API"
    default: "broker"

  seaweedfs.broker.auth.password:
    description: "Basic auth password for the broker API"

  seaweedfs.broker.tls.enabled:
    description: "Enable TLS for the broker API"
    default: false

  seaweedfs.broker.tls.ca:
    description: "CA certificate for TLS"
    default: ""

  seaweedfs.broker.tls.certificate:
    description: "Server certificate for TLS"
    default: ""

  seaweedfs.broker.tls.private_key:
    description: "Server private key for TLS"
    default: ""

  # Catalog configuration
  seaweedfs.broker.catalog.service_id:
    description: "Service ID for the broker catalog"
    default: "seaweedfs-service"

  seaweedfs.broker.catalog.service_name:
    description: "Service name for the broker catalog"
    default: "seaweedfs"

  seaweedfs.broker.catalog.service_description:
    description: "Service description for the broker catalog"
    default: "SeaweedFS distributed object storage with S3-compatible API"

  # Shared cluster configuration
  seaweedfs.broker.shared_cluster.enabled:
    description: "Whether the shared cluster plan is enabled"
    default: true

  seaweedfs.broker.shared_cluster.s3_endpoint:
    description: "S3 endpoint of the shared SeaweedFS cluster"
    default: ""

  seaweedfs.broker.shared_cluster.filer_endpoint:
    description: "Filer endpoint of the shared SeaweedFS cluster"
    default: ""

  seaweedfs.broker.shared_cluster.access_key:
    description: "Admin access key for the shared cluster"
    default: ""

  seaweedfs.broker.shared_cluster.secret_key:
    description: "Admin secret key for the shared cluster"
    default: ""

  seaweedfs.broker.shared_cluster.use_ssl:
    description: "Use SSL/TLS for S3 connections (via gorouter)"
    default: true

  seaweedfs.broker.shared_cluster.region:
    description: "S3 region for the shared cluster"
    default: "us-east-1"

  # BOSH configuration for on-demand instances (ODB-style structure)
  seaweedfs.broker.bosh.url:
    description: "BOSH Director URL (e.g., https://director:25555)"
    default: ""

  seaweedfs.broker.bosh.root_ca_cert:
    description: "BOSH Director root CA certificate"
    default: ""

  seaweedfs.broker.bosh.authentication.uaa.url:
    description: "UAA URL for BOSH authentication (e.g., https://director:8443)"
    default: ""

  seaweedfs.broker.bosh.authentication.uaa.client_id:
    description: "UAA client ID for BOSH access"
    default: ""

  seaweedfs.broker.bosh.authentication.uaa.client_secret:
    description: "UAA client secret for BOSH access"
    default: ""

  # On-demand deployment configuration
  seaweedfs.broker.on_demand.service_name:
    description: "Service name for on-demand deployments"
    default: "seaweedfs"

  seaweedfs.broker.on_demand.plans:
    description: |
      Array of on-demand plans configured via Ops Manager service_plan_forms.
      Each plan contains: name, guid, plan_description, deployment_type, vm_type, disk_type, storage_quota_gb
    default: []

  seaweedfs.broker.on_demand.stemcell_os:
    description: "Stemcell OS for on-demand deployments"
    default: "ubuntu-jammy"

  seaweedfs.broker.on_demand.stemcell_version:
    description: "Stemcell version for on-demand deployments"
    default: "latest"

  seaweedfs.broker.on_demand.network:
    description: "Network for on-demand deployments"
    default: "default"

  seaweedfs.broker.on_demand.azs:
    description: "Availability zones for on-demand deployments (array). Uses the AZs assigned to the tile in Ops Manager."
    default: ["z1", "z2", "z3"]

  # Legacy properties for backwards compatibility
  seaweedfs.broker.bosh.deployment_prefix:
    description: "Prefix for on-demand deployment names"
    default: "seaweedfs-ondemand"

  seaweedfs.broker.bosh.release_name:
    description: "SeaweedFS BOSH release name"
    default: "seaweedfs"

  seaweedfs.broker.bosh.release_version:
    description: "SeaweedFS BOSH release version"
    default: "latest"

  # Route registrar configuration (for Cloud Foundry integration)
  seaweedfs.broker.route_registrar.enabled:
    description: "Enable route registration with Cloud Foundry router"
    default: false

  seaweedfs.broker.route_registrar.routes:
    description: "Routes to register with the Cloud Foundry router"
    default: []
