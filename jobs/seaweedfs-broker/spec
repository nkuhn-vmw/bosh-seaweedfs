---
name: seaweedfs-broker

templates:
  ctl.erb: bin/ctl
  broker.yml.erb: config/broker.yml
  bpm.yml.erb: config/bpm.yml
  ca.crt.erb: config/certs/ca.crt
  server.crt.erb: config/certs/server.crt
  server.key.erb: config/certs/server.key
  bosh_ca.crt.erb: config/certs/bosh_ca.crt

packages:
  - seaweedfs-broker

consumes:
  - name: seaweedfs-s3
    type: seaweedfs-s3
    optional: true

provides:
  - name: seaweedfs-broker
    type: seaweedfs-broker
    properties:
      - seaweedfs.broker.port

properties:
  seaweedfs.broker.port:
    description: "Port for the service broker API"
    default: 8080

  seaweedfs.broker.log_level:
    description: "Log level (debug, info, warn, error)"
    default: "info"

  seaweedfs.broker.auth.username:
    description: "Basic auth username for the broker API"
    default: "broker"

  seaweedfs.broker.auth.password:
    description: "Basic auth password for the broker API"

  seaweedfs.broker.tls.enabled:
    description: "Enable TLS for the broker API"
    default: false

  seaweedfs.broker.tls.ca:
    description: "CA certificate for TLS"
    default: ""

  seaweedfs.broker.tls.certificate:
    description: "Server certificate for TLS"
    default: ""

  seaweedfs.broker.tls.private_key:
    description: "Server private key for TLS"
    default: ""

  # Catalog configuration
  seaweedfs.broker.catalog.service_id:
    description: "Service ID for the broker catalog"
    default: "seaweedfs-service"

  seaweedfs.broker.catalog.service_name:
    description: "Service name for the broker catalog"
    default: "seaweedfs"

  seaweedfs.broker.catalog.service_description:
    description: "Service description for the broker catalog"
    default: "SeaweedFS distributed object storage with S3-compatible API"

  seaweedfs.broker.catalog.plans:
    description: |
      List of service plans. Each plan should have:
        - id: unique plan ID
        - name: plan name
        - description: plan description
        - free: whether the plan is free (boolean)
        - plan_type: "shared" or "dedicated"
        - dedicated_config: (for dedicated plans)
            - vm_type: BOSH VM type
            - disk_type: BOSH persistent disk type
            - master_nodes: number of master nodes
            - volume_nodes: number of volume nodes
            - filer_nodes: number of filer nodes
            - network: BOSH network name
            - azs: list of availability zones
    default:
      - id: "shared-bucket"
        name: "shared"
        description: "Shared SeaweedFS cluster with dedicated bucket"
        free: true
        plan_type: "shared"
      - id: "dedicated-small"
        name: "dedicated-small"
        description: "Small dedicated SeaweedFS cluster (1 master, 3 volumes, 1 filer)"
        free: false
        plan_type: "dedicated"
        dedicated_config:
          vm_type: "small"
          disk_type: "10GB"
          master_nodes: 1
          volume_nodes: 3
          filer_nodes: 1
          network: "default"
          azs: ["z1", "z2", "z3"]
      - id: "dedicated-large"
        name: "dedicated-large"
        description: "Large dedicated SeaweedFS cluster (3 masters, 6 volumes, 2 filers)"
        free: false
        plan_type: "dedicated"
        dedicated_config:
          vm_type: "large"
          disk_type: "100GB"
          master_nodes: 3
          volume_nodes: 6
          filer_nodes: 2
          network: "default"
          azs: ["z1", "z2", "z3"]

  # Shared cluster configuration
  seaweedfs.broker.shared_cluster.s3_endpoint:
    description: "S3 endpoint of the shared SeaweedFS cluster"
    default: ""

  seaweedfs.broker.shared_cluster.filer_endpoint:
    description: "Filer endpoint of the shared SeaweedFS cluster"
    default: ""

  seaweedfs.broker.shared_cluster.access_key:
    description: "Admin access key for the shared cluster"
    default: ""

  seaweedfs.broker.shared_cluster.secret_key:
    description: "Admin secret key for the shared cluster"
    default: ""

  seaweedfs.broker.shared_cluster.use_ssl:
    description: "Use SSL for shared cluster connections"
    default: false

  seaweedfs.broker.shared_cluster.region:
    description: "S3 region for the shared cluster"
    default: "us-east-1"

  # BOSH configuration for on-demand instances
  seaweedfs.broker.bosh.director_url:
    description: "BOSH Director URL"
    default: ""

  seaweedfs.broker.bosh.director_ca_cert:
    description: "BOSH Director CA certificate"
    default: ""

  seaweedfs.broker.bosh.client_id:
    description: "UAA client ID for BOSH access"
    default: ""

  seaweedfs.broker.bosh.client_secret:
    description: "UAA client secret for BOSH access"
    default: ""

  seaweedfs.broker.bosh.deployment_prefix:
    description: "Prefix for on-demand deployment names"
    default: "seaweedfs-ondemand"

  seaweedfs.broker.bosh.release_name:
    description: "SeaweedFS BOSH release name"
    default: "seaweedfs"

  seaweedfs.broker.bosh.release_version:
    description: "SeaweedFS BOSH release version"
    default: "latest"

  seaweedfs.broker.bosh.stemcell_os:
    description: "Stemcell OS for on-demand deployments"
    default: "ubuntu-jammy"

  seaweedfs.broker.bosh.stemcell_version:
    description: "Stemcell version for on-demand deployments"
    default: "latest"

  # Route registrar configuration (for Cloud Foundry integration)
  seaweedfs.broker.route_registrar.enabled:
    description: "Enable route registration with Cloud Foundry router"
    default: false

  seaweedfs.broker.route_registrar.routes:
    description: "Routes to register with the Cloud Foundry router"
    default: []
