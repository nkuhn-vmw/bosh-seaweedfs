#!/bin/bash
# Health check script for SeaweedFS Filer
# Returns 0 if healthy, 1 if unhealthy

set -e

PORT=<%= p('seaweedfs.filer.port') %>
TIMEOUT=5

# Check if the filer HTTP API is responding
HTTP_CODE=$(curl -s -o /dev/null -w '%{http_code}' --connect-timeout ${TIMEOUT} "http://127.0.0.1:${PORT}/" 2>/dev/null || echo "000")

if [ "$HTTP_CODE" = "200" ]; then
  echo "SeaweedFS Filer is healthy"
  exit 0
else
  echo "SeaweedFS Filer health check failed (HTTP ${HTTP_CODE})"
  exit 1
fi
